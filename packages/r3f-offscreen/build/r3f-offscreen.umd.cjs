(function(l,E){typeof exports=="object"&&typeof module<"u"?E(exports,require("react/jsx-runtime"),require("react"),require("@react-three/fiber"),require("three"),require("mitt")):typeof define=="function"&&define.amd?define(["exports","react/jsx-runtime","react","@react-three/fiber","three","mitt"],E):(l=typeof globalThis<"u"?globalThis:l||self,E(l["r3f-offscreen"]={},l.jsxRuntime,l.React,l.fiber,l.THREE,l.mitt))})(this,function(l,E,v,w,O,z){"use strict";function T(a){const n=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(a){for(const d in a)if(d!=="default"){const r=Object.getOwnPropertyDescriptor(a,d);Object.defineProperty(n,d,r.get?r:{enumerable:!0,get:()=>a[d]})}}return n.default=a,Object.freeze(n)}const x=T(O),j={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function S(a){return n=>{const{handlePointer:d}=w.createEvents(n);return{priority:1,enabled:!0,compute(r,o){o.pointer.set(r.offsetX/o.size.width*2-1,-(r.offsetY/o.size.height)*2+1),o.raycaster.setFromCamera(o.pointer,o.camera)},connected:void 0,handlers:Object.keys(j).reduce((r,o)=>({...r,[o]:d(o)}),{}),connect:r=>{var p;const{set:o,events:f}=n.getState();(p=f.disconnect)==null||p.call(f),o(g=>({events:{...g.events,connected:r}})),Object.entries((f==null?void 0:f.handlers)??[]).forEach(([g,C])=>{const[y]=j[g];a.on(y,C)})},disconnect:()=>{const{set:r,events:o}=n.getState();o.connected&&(Object.entries(o.handlers??[]).forEach(([f,p])=>{const[g]=j[f];a.off(g,p)}),r(f=>({events:{...f.events,connected:void 0}})))}}}}function X(a){return a&&a.current!==void 0}function Y({eventSource:a,worker:n,fallback:d,style:r,className:o,id:f,...p}){const[g,C]=v.useState(!1),y=v.useRef(null),t=v.useRef(!1);return v.useEffect(()=>{if(!n)return;const i=y.current;try{if(!t.current){const s=y.current.transferControlToOffscreen();t.current=!0,n.postMessage({type:"init",payload:{props:p,drawingSurface:s,width:i.clientWidth,height:i.clientHeight,top:i.offsetTop,left:i.offsetLeft,pixelRatio:window.devicePixelRatio}},[s])}}catch{C(!0);return}n.onmessage=s=>{s.data.type==="error"&&C(!0)};const c=X(a)?a.current:a||i;Object.values(j).forEach(([s,h])=>{c.addEventListener(s,e=>{h||e.preventDefault(),s==="pointerdown"?e.target.setPointerCapture(e.pointerId):s==="pointerup"&&e.target.releasePointerCapture(e.pointerId),n.postMessage({type:"dom_events",payload:{eventName:s,deltaX:e.deltaX,deltaY:e.deltaY,pointerId:e.pointerId,pointerType:e.pointerType,button:e.button,buttons:e.buttons,altKey:e.altKey,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,movementX:e.movementX,movementY:e.movementY,clientX:e.clientX,clientY:e.clientY,offsetX:e.offsetX,offsetY:e.offsetY,pageX:e.pageX,pageY:e.pageY,x:e.x,y:e.y}})},{passive:h})});const u=()=>{n.postMessage({type:"resize",payload:{width:c.clientWidth,height:c.clientHeight,top:c.offsetTop,left:c.offsetLeft}})};return window.addEventListener("resize",u),()=>{window.removeEventListener("resize",u)}},[n]),v.useEffect(()=>{n&&n.postMessage({type:"props",payload:p})},[n,p]),g?E.jsx(w.Canvas,{id:f,className:o,style:r,...p,children:d}):E.jsx("canvas",{id:f,className:o,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",display:"block",...r},ref:y})}function M(a){w.extend(x);let n,d=[1,2],r={width:0,height:0,top:0,left:0,updateStyle:!1};const o=z(),y={resize:({width:t,height:i,top:c,left:u})=>{n&&n.configure({size:r={width:t,height:i,top:c,left:u,updateStyle:!1},dpr:d})},init:t=>{const{props:i,drawingSurface:c,width:u,top:s,left:h,height:e,pixelRatio:R}=t;try{n&&n.unmount(),Object.assign(c,{pageXOffset:h,pageYOffset:s,clientLeft:h,clientTop:s,clientWidth:u,clientHeight:e,style:{touchAction:"none"},ownerDocument:c,documentElement:c,getBoundingClientRect(){return r},setAttribute(){},setPointerCapture(){},releasePointerCapture(){},addEventListener(m,P){o.on(m,P)},removeEventListener(m,P){o.off(m,P)}}),n=w.createRoot(c),n.configure({events:S(o),size:r={width:u,height:e,top:s,left:h,updateStyle:!1},dpr:d=Math.min(Math.max(1,R),2),...i,onCreated:m=>{i.eventPrefix&&m.setEvents({compute:(P,b)=>{const I=P[i.eventPrefix+"X"],L=P[i.eventPrefix+"Y"];b.pointer.set(I/b.size.width*2-1,-(L/b.size.height)*2+1),b.raycaster.setFromCamera(b.pointer,b.camera)}})}}),n.render(a)}catch(m){postMessage({type:"error",payload:m==null?void 0:m.message})}self.window=c},dom_events:t=>{o.emit(t.eventName,{...t,preventDefault(){},stopPropagation(){}})},props:t=>{n&&(t.dpr&&(d=t.dpr),n.configure({size:r,dpr:d,...t}))}};self.onmessage=t=>{const{type:i,payload:c}=t.data,u=y[i];u&&u(c)},x.ImageLoader.prototype.load=function(t,i,c,u){this.path!==void 0&&(t=this.path+t),t=this.manager.resolveURL(t);const s=this,h=x.Cache.get(t);return h!==void 0?(s.manager.itemStart(t),i&&i(h),s.manager.itemEnd(t),h):(fetch(t).then(e=>e.blob()).then(e=>createImageBitmap(e,{premultiplyAlpha:"none",colorSpaceConversion:"none"})).then(e=>{x.Cache.add(t,e),i&&i(e),s.manager.itemEnd(t)}).catch(u),{})},self.window={},self.document={},self.Image=class{constructor(){this.height=1,this.width=1}set onload(t){t(!0)}}}l.Canvas=Y,l.render=M,Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});
//# sourceMappingURL=r3f-offscreen.umd.cjs.map
